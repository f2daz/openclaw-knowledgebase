{% if results %}
<div class="space-y-3">
    <p class="text-sm text-gray-400 mb-4">
        Found {{ results|length }} result{% if results|length != 1 %}s{% endif %}
        {% if query %}for "<span class="text-cyan-400">{{ query }}</span>"{% endif %}
    </p>
    
    {% for result in results %}
    <div class="glass rounded-xl p-4 hover:bg-white/5 transition-colors edge-cyan">
        <!-- Header -->
        <div class="flex items-start justify-between mb-3">
            <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                    <!-- Source Type Badge -->
                    <span class="text-xs px-2 py-0.5 rounded-full bg-cyan-500/20 text-cyan-400">
                        {{ result.source_type or 'web' }}
                    </span>
                    
                    <!-- Similarity Score -->
                    <span class="text-xs px-2 py-0.5 rounded-full 
                        {% if result.similarity >= 0.7 %}bg-green-500/20 text-green-400
                        {% elif result.similarity >= 0.5 %}bg-yellow-500/20 text-yellow-400
                        {% else %}bg-gray-500/20 text-gray-400{% endif %}">
                        {{ "%.0f"|format(result.similarity * 100) }}% match
                    </span>
                </div>
                
                <!-- Title -->
                <h3 class="font-semibold text-white">{{ result.title or 'Untitled' }}</h3>
                
                <!-- URL -->
                {% if result.url %}
                <a href="{{ result.url }}" target="_blank" 
                   class="text-xs text-gray-500 hover:text-cyan-400 flex items-center gap-1 mt-1 truncate max-w-lg">
                    <i data-lucide="external-link" class="w-3 h-3"></i>
                    {{ result.url }}
                </a>
                {% endif %}
            </div>
            
            <!-- Chunk Number -->
            <span class="text-xs text-gray-600">Chunk #{{ result.chunk_number }}</span>
        </div>
        
        <!-- Content Preview -->
        <div class="text-sm text-gray-300 bg-black/30 rounded-lg p-3 leading-relaxed overflow-hidden">
            <div class="prose prose-sm prose-invert max-w-none">
                {% set preview = result.content[:600] %}
                {% if query %}
                    {# Highlight query terms #}
                    {% for word in query.split()[:3] %}
                        {% set preview = preview.replace(word, '<mark class="bg-cyan-500/30 text-cyan-200 px-0.5 rounded">' ~ word ~ '</mark>') %}
                        {% set preview = preview.replace(word.lower(), '<mark class="bg-cyan-500/30 text-cyan-200 px-0.5 rounded">' ~ word.lower() ~ '</mark>') %}
                        {% set preview = preview.replace(word.capitalize(), '<mark class="bg-cyan-500/30 text-cyan-200 px-0.5 rounded">' ~ word.capitalize() ~ '</mark>') %}
                    {% endfor %}
                {% endif %}
                <div class="whitespace-pre-wrap break-words">{{ preview | safe }}{% if result.content|length > 600 %}...{% endif %}</div>
            </div>
        </div>
        
        <!-- Expand/Collapse -->
        {% if result.content|length > 600 %}
        <details class="mt-2">
            <summary class="text-xs text-cyan-400 cursor-pointer hover:text-cyan-300">
                Show full content ({{ result.content|length }} chars)
            </summary>
            <div class="mt-2 text-sm text-gray-400 bg-black/20 rounded-lg p-3 max-h-96 overflow-y-auto">
                <pre class="whitespace-pre-wrap break-words">{{ result.content }}</pre>
            </div>
        </details>
        {% endif %}
        
        <!-- Metadata Footer -->
        <div class="flex items-center gap-4 mt-3 text-xs text-gray-500">
            <span class="flex items-center gap-1">
                <i data-lucide="hash" class="w-3 h-3"></i>
                Chunk {{ result.chunk_number }}
            </span>
            <span class="flex items-center gap-1">
                <i data-lucide="text" class="w-3 h-3"></i>
                {{ result.content|length }} chars
            </span>
            {% if result.source_id %}
            <span class="flex items-center gap-1 text-gray-600">
                <i data-lucide="database" class="w-3 h-3"></i>
                {{ result.source_id[:8] if result.source_id|length > 8 else result.source_id }}
            </span>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

{% elif query %}
<div class="text-center py-16">
    <i data-lucide="search-x" class="w-16 h-16 text-gray-600 mx-auto mb-4"></i>
    <p class="text-gray-500">No results found for "{{ query }}"</p>
    <p class="text-gray-600 text-sm mt-2">Try different keywords or enable hybrid search</p>
</div>

{% else %}
<div class="text-center py-16">
    <i data-lucide="search" class="w-16 h-16 text-gray-600 mx-auto mb-4"></i>
    <p class="text-gray-500">Enter a query to search your knowledge base</p>
</div>
{% endif %}
